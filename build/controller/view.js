import{getContext as e,getElement as r,store as t,withScope as n,withSyncEvent as s}from"@wordpress/interactivity";var o={150:(e,r,t)=>{!function(){var r=t(242),n=t(934).utf8,s=t(703),o=t(934).bin,i=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?o.stringToBytes(e):n.stringToBytes(e):s(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var u=r.bytesToWords(e),c=8*e.length,a=1732584193,l=-271733879,d=-1732584194,g=271733878,p=0;p<u.length;p++)u[p]=16711935&(u[p]<<8|u[p]>>>24)|4278255360&(u[p]<<24|u[p]>>>8);u[c>>>5]|=128<<c%32,u[14+(c+64>>>9<<4)]=c;var f=i._ff,h=i._gg,b=i._hh,y=i._ii;for(p=0;p<u.length;p+=16){var m=a,v=l,z=d,S=g;a=f(a,l,d,g,u[p+0],7,-680876936),g=f(g,a,l,d,u[p+1],12,-389564586),d=f(d,g,a,l,u[p+2],17,606105819),l=f(l,d,g,a,u[p+3],22,-1044525330),a=f(a,l,d,g,u[p+4],7,-176418897),g=f(g,a,l,d,u[p+5],12,1200080426),d=f(d,g,a,l,u[p+6],17,-1473231341),l=f(l,d,g,a,u[p+7],22,-45705983),a=f(a,l,d,g,u[p+8],7,1770035416),g=f(g,a,l,d,u[p+9],12,-1958414417),d=f(d,g,a,l,u[p+10],17,-42063),l=f(l,d,g,a,u[p+11],22,-1990404162),a=f(a,l,d,g,u[p+12],7,1804603682),g=f(g,a,l,d,u[p+13],12,-40341101),d=f(d,g,a,l,u[p+14],17,-1502002290),a=h(a,l=f(l,d,g,a,u[p+15],22,1236535329),d,g,u[p+1],5,-165796510),g=h(g,a,l,d,u[p+6],9,-1069501632),d=h(d,g,a,l,u[p+11],14,643717713),l=h(l,d,g,a,u[p+0],20,-373897302),a=h(a,l,d,g,u[p+5],5,-701558691),g=h(g,a,l,d,u[p+10],9,38016083),d=h(d,g,a,l,u[p+15],14,-660478335),l=h(l,d,g,a,u[p+4],20,-405537848),a=h(a,l,d,g,u[p+9],5,568446438),g=h(g,a,l,d,u[p+14],9,-1019803690),d=h(d,g,a,l,u[p+3],14,-187363961),l=h(l,d,g,a,u[p+8],20,1163531501),a=h(a,l,d,g,u[p+13],5,-1444681467),g=h(g,a,l,d,u[p+2],9,-51403784),d=h(d,g,a,l,u[p+7],14,1735328473),a=b(a,l=h(l,d,g,a,u[p+12],20,-1926607734),d,g,u[p+5],4,-378558),g=b(g,a,l,d,u[p+8],11,-2022574463),d=b(d,g,a,l,u[p+11],16,1839030562),l=b(l,d,g,a,u[p+14],23,-35309556),a=b(a,l,d,g,u[p+1],4,-1530992060),g=b(g,a,l,d,u[p+4],11,1272893353),d=b(d,g,a,l,u[p+7],16,-155497632),l=b(l,d,g,a,u[p+10],23,-1094730640),a=b(a,l,d,g,u[p+13],4,681279174),g=b(g,a,l,d,u[p+0],11,-358537222),d=b(d,g,a,l,u[p+3],16,-722521979),l=b(l,d,g,a,u[p+6],23,76029189),a=b(a,l,d,g,u[p+9],4,-640364487),g=b(g,a,l,d,u[p+12],11,-421815835),d=b(d,g,a,l,u[p+15],16,530742520),a=y(a,l=b(l,d,g,a,u[p+2],23,-995338651),d,g,u[p+0],6,-198630844),g=y(g,a,l,d,u[p+7],10,1126891415),d=y(d,g,a,l,u[p+14],15,-1416354905),l=y(l,d,g,a,u[p+5],21,-57434055),a=y(a,l,d,g,u[p+12],6,1700485571),g=y(g,a,l,d,u[p+3],10,-1894986606),d=y(d,g,a,l,u[p+10],15,-1051523),l=y(l,d,g,a,u[p+1],21,-2054922799),a=y(a,l,d,g,u[p+8],6,1873313359),g=y(g,a,l,d,u[p+15],10,-30611744),d=y(d,g,a,l,u[p+6],15,-1560198380),l=y(l,d,g,a,u[p+13],21,1309151649),a=y(a,l,d,g,u[p+4],6,-145523070),g=y(g,a,l,d,u[p+11],10,-1120210379),d=y(d,g,a,l,u[p+2],15,718787259),l=y(l,d,g,a,u[p+9],21,-343485551),a=a+m>>>0,l=l+v>>>0,d=d+z>>>0,g=g+S>>>0}return r.endian([a,l,d,g])};i._ff=function(e,r,t,n,s,o,i){var u=e+(r&t|~r&n)+(s>>>0)+i;return(u<<o|u>>>32-o)+r},i._gg=function(e,r,t,n,s,o,i){var u=e+(r&n|t&~n)+(s>>>0)+i;return(u<<o|u>>>32-o)+r},i._hh=function(e,r,t,n,s,o,i){var u=e+(r^t^n)+(s>>>0)+i;return(u<<o|u>>>32-o)+r},i._ii=function(e,r,t,n,s,o,i){var u=e+(t^(r|~n))+(s>>>0)+i;return(u<<o|u>>>32-o)+r},i._blocksize=16,i._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=r.wordsToBytes(i(e,t));return t&&t.asBytes?n:t&&t.asString?o.bytesToString(n):r.bytesToHex(n)}}()},242:e=>{var r,t;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(e,r){return e<<r|e>>>32-r},rotr:function(e,r){return e<<32-r|e>>>r},endian:function(e){if(e.constructor==Number)return 16711935&t.rotl(e,8)|4278255360&t.rotl(e,24);for(var r=0;r<e.length;r++)e[r]=t.endian(e[r]);return e},randomBytes:function(e){for(var r=[];e>0;e--)r.push(Math.floor(256*Math.random()));return r},bytesToWords:function(e){for(var r=[],t=0,n=0;t<e.length;t++,n+=8)r[n>>>5]|=e[t]<<24-n%32;return r},wordsToBytes:function(e){for(var r=[],t=0;t<32*e.length;t+=8)r.push(e[t>>>5]>>>24-t%32&255);return r},bytesToHex:function(e){for(var r=[],t=0;t<e.length;t++)r.push((e[t]>>>4).toString(16)),r.push((15&e[t]).toString(16));return r.join("")},hexToBytes:function(e){for(var r=[],t=0;t<e.length;t+=2)r.push(parseInt(e.substr(t,2),16));return r},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var s=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(s>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,s=0;n<e.length;s=++n%4)0!=s&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*s+8)-1)<<2*s|r.indexOf(e.charAt(n))>>>6-2*s);return t}},e.exports=t},438:e=>{e.exports=import("@wordpress/interactivity-router")},703:e=>{function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},934:e=>{var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var r=[],t=0;t<e.length;t++)r.push(255&e.charCodeAt(t));return r},bytesToString:function(e){for(var r=[],t=0;t<e.length;t++)r.push(String.fromCharCode(e[t]));return r.join("")}}};e.exports=r}},i={};function u(e){var r=i[e];if(void 0!==r)return r.exports;var t=i[e]={exports:{}};return o[e](t,t.exports,u),t.exports}u.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return u.d(r,{a:r}),r},u.d=(e,r)=>{for(var t in r)u.o(r,t)&&!u.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},u.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var c=u(150),a=u.n(c);function l(e){return Object.values(e).filter(e=>e.correct)}function d(e){return Object.values(e).filter(e=>!e.correct)}const{wp:g,location:p,localStorage:f}=window,{url:h,apiFetch:b}=g,{addQueryArgs:y,getQueryArg:m,getPathAndQueryString:v}=h,{state:z,actions:S}=t("prc-quiz/controller",{state:{currentSessionArchetypes:[],get quizId(){const{quizId:r}=e();return r},get nonce(){const{nonce:r}=e();return r},get quizData(){const{quizId:r}=e();return z[`quiz_${r}`]},get questions(){const{quizId:r}=e();return z[`quiz_${r}`].questions},get answers(){const{quizId:r}=e(),t=z[`quiz_${r}`];return Object.values(t.questions).reduce((e,r)=>({...e,...r.answers}),{})},get isConditionalAnswerSelected(){const r=e(),{conditionalDisplay:t,conditionalAnswerUuid:n,selectedAnswers:s,uuid:o,quizId:i}=r;if(!t||!n)return!1;if(z[`quiz_${i}`].questions[n])return Object.keys(z[`quiz_${i}`].questions).includes(n)&&s[n].length>0;const u=Object.values(s).flat();return u.includes(n)||u.includes(o)},get displayResults(){const{displayResults:r}=e();return r},get displayPages(){const{displayType:r}=e();return"scrollable"===r||!z.displayResults&&!z.displayGroupResults},get displayGroupResults(){const{displayGroupResults:r}=e();return r},get hasConsentForCookies(){return"function"!=typeof window.wp_has_consent||window.wp_has_consent("functional")},get quizProgress(){const e=z.cookie;return e&&"object"==typeof e&&e.quiz_id?e:null},get hasQuizProgress(){const{quizId:r}=e(),t=z.quizProgress;return t&&t.quiz_id===r},get cookie(){if(!z.hasConsentForCookies)return null;const e=document.cookie.split(";");for(let r=0;r<e.length;r++){let t=e[r];for(;" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf("prc-quiz-builder=")){const e=t.substring(17,t.length),r=decodeURIComponent(e);try{return JSON.parse(r)}catch(e){return r}}}return null}},actions:{scoreQuiz:()=>{const{userSubmission:r}=e(),{answers:t,questions:n}=z;return function(e,r,t){if(!r||!t)return null;const n=a()(e.join(",")),s=function(e,r){return e.reduce((e,t)=>e+r[t].points,0)}(e,r),o=function(e,r){const t={};return Object.values(e).forEach(e=>{const n=e.uuid,s=e.internalId||n,o=Object.values(e.answers).find(e=>r.includes(e.uuid)),i=o?.points||0;t[s]=i}),t}(t,e),i=function(e,r){const t={};return r.forEach(r=>{const n=e[r];n&&(t[r]=n.points)}),t}(r,e);return{hash:n,score:s,userSubmission:e,resultsData:{correctAnswersGiven:e.filter(e=>r[e].correct),incorrectAnswersGiven:e.filter(e=>!r[e].correct),questionPointsMatrix:o,answerPointsMatrix:i},quizData:{correctAnswers:l(r),incorrectAnswers:d(r)}}}(r,t,n)},runAnimation:()=>{const{ref:e}=r(),n=t("prc-block/animation"),s=e.querySelectorAll(".wp-block-prc-block-animation");s.length&&s.forEach(e=>{const r=e.getAttribute("id"),{parentElement:t}=e,s=null!==t?.getAttribute("hidden");r&&!s&&(n.state[r].enabled=!0)})},onStartQuizClick:s(r=>{const t=e(),{uuid:n,currentPageUuid:s,pages:o}=t;t.currentPageUuid=o[1],S.saveQuizProgress()}),onNextPageClick:s(r=>{const t=e(),{uuid:n,currentPageUuid:s,pages:o}=t,i=o.indexOf(s);t.currentPageUuid=o[i+1],S.saveQuizProgress()}),onPreviousPageClick:s(r=>{const t=e(),{uuid:n,currentPageUuid:s,pages:o}=t,i=o.indexOf(s);t.currentPageUuid=o[i-1],S.saveQuizProgress()}),onSubmitQuizClick:s(e=>{S.submitQuiz()}),onResetQuizClick:s(r=>{const t=e(),{quizUrl:n,displayResults:s}=t;s?window.location.href=n:S.resetQuiz(),S.saveQuizProgress()}),goBackToFirstPage:()=>{const r=e();r.processing=!1,r.submitted=!1,r.currentPageUuid=r.firstPageUuid},resetQuiz:()=>{const r=e();r.submitted=!1,r.processing=!1,r.displayResults=!1,r.selectedAnswers={},r.userSubmission={},r.userScore={},r.currentPageUuid=r.firstPageUuid},clearCookie:()=>{document.cookie="prc-quiz-builder=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},setCookie:r=>{const{quizId:t}=e();if(!z.hasConsentForCookies)return!1;let n;n="object"==typeof r&&null!==r?encodeURIComponent(JSON.stringify(r)):encodeURIComponent(String(r));const s=new Date;s.setTime(s.getTime()+2592e6);const o="expires="+s.toUTCString();return document.cookie="prc-quiz-builder="+n+";"+o+";path=/",!0},saveQuizProgress:(r=null)=>{const{selectedAnswers:t,currentPageUuid:n,quizId:s}=e(),o={quiz_id:s,selectedAnswers:t,currentPageUuid:n,timestamp:Date.now()};return r&&(o.score=r),S.setCookie(o)},*submitQuiz(){const r=e(),{answerThreshold:t,displayType:s,userScore:o,quizId:i,nonce:c,groupsEnabled:a,groupId:l,quizUrl:d,readyForSubmission:g,allowSubmissions:p,isPreview:f}=r,{hash:h,userSubmission:m,score:v}=o;let q=null,w={hash:h,userSubmission:m,score:v};if(r.processing=!0,!g)return void(confirm(`You must answer ${t} questions to submit the quiz.\n\nWould you like to reset the quiz and start over?`)?S.resetQuiz():"scrollable"!==s&&confirm("Would you like to go back to the first page to answer more questions?")&&S.goBackToFirstPage());const P={quizId:i,nonce:c};a&&l&&(P.groupId=l),S.parseSubmissionRequest&&(w=yield S.parseSubmissionRequest(w),v!==w.score&&(q=w.score)),setTimeout(n(function*(){const e=yield Promise.resolve().then(u.bind(u,438));return r.displayResults=!0,f?(r.readyForSubmission=!1,r.processing=!1,void(q&&(r.userScore={...r.userScore,score:q}))):(S.clearCookie(),e.actions.navigate(`${d}results/${h}`),z.currentSessionArchetypes.includes(h)||!p?(r.readyForSubmission=!1,r.processing=!1,void(q&&(r.userScore={...r.userScore,score:q}))):(z.currentSessionArchetypes.push(h),void b({path:y("/prc-api/v3/quiz/submit",P),method:"POST",data:w}).then(e=>{console.log("submitQuiz response ->",e)}).catch(e=>{console.error("submitQuiz error ->",e)}).finally(()=>{q&&(r.userScore={...r.userScore,score:q}),r.processing=!1,r.readyForSubmission=!1})))}),1e3)}},callbacks:{onInit:()=>{const r=e();r.processing=!0,setTimeout(n(()=>{r.processing=!1,r.loaded=!0}),1500)},onScrollableSubmit:s(()=>{const r=e(),{submitted:t,readyForSubmission:s,displayType:o,processing:i}=r;"scrollable"===o&&s&&!i&&setTimeout(n(()=>{S.submitQuiz()}),1200)}),updateUserSubmission:()=>{const r=e(),{selectedAnswers:t,answerThreshold:n}=r,s=Object.values(t||{}).flat();r.userSubmission=s,s.length>=n&&(r.readyForSubmission=!0)},updateUserScore:()=>{const r=e(),{userSubmission:t,quizId:n,displayResults:s}=r;if(s)return;if(!t)return;if(!n)return;if(0===t.length)return;r.userScore;const o=S.scoreQuiz();r.userScore=o}}});
//# sourceMappingURL=view.js.map