import*as e from"@wordpress/interactivity";var t={150:(e,t,r)=>{!function(){var t=r(242),n=r(934).utf8,o=r(703),s=r(934).bin,i=function(e,r){e.constructor==String?e=r&&"binary"===r.encoding?s.stringToBytes(e):n.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var u=t.bytesToWords(e),c=8*e.length,a=1732584193,l=-271733879,d=-1732584194,g=271733878,p=0;p<u.length;p++)u[p]=16711935&(u[p]<<8|u[p]>>>24)|4278255360&(u[p]<<24|u[p]>>>8);u[c>>>5]|=128<<c%32,u[14+(c+64>>>9<<4)]=c;var f=i._ff,h=i._gg,y=i._hh,b=i._ii;for(p=0;p<u.length;p+=16){var S=a,m=l,v=d,w=g;a=f(a,l,d,g,u[p+0],7,-680876936),g=f(g,a,l,d,u[p+1],12,-389564586),d=f(d,g,a,l,u[p+2],17,606105819),l=f(l,d,g,a,u[p+3],22,-1044525330),a=f(a,l,d,g,u[p+4],7,-176418897),g=f(g,a,l,d,u[p+5],12,1200080426),d=f(d,g,a,l,u[p+6],17,-1473231341),l=f(l,d,g,a,u[p+7],22,-45705983),a=f(a,l,d,g,u[p+8],7,1770035416),g=f(g,a,l,d,u[p+9],12,-1958414417),d=f(d,g,a,l,u[p+10],17,-42063),l=f(l,d,g,a,u[p+11],22,-1990404162),a=f(a,l,d,g,u[p+12],7,1804603682),g=f(g,a,l,d,u[p+13],12,-40341101),d=f(d,g,a,l,u[p+14],17,-1502002290),a=h(a,l=f(l,d,g,a,u[p+15],22,1236535329),d,g,u[p+1],5,-165796510),g=h(g,a,l,d,u[p+6],9,-1069501632),d=h(d,g,a,l,u[p+11],14,643717713),l=h(l,d,g,a,u[p+0],20,-373897302),a=h(a,l,d,g,u[p+5],5,-701558691),g=h(g,a,l,d,u[p+10],9,38016083),d=h(d,g,a,l,u[p+15],14,-660478335),l=h(l,d,g,a,u[p+4],20,-405537848),a=h(a,l,d,g,u[p+9],5,568446438),g=h(g,a,l,d,u[p+14],9,-1019803690),d=h(d,g,a,l,u[p+3],14,-187363961),l=h(l,d,g,a,u[p+8],20,1163531501),a=h(a,l,d,g,u[p+13],5,-1444681467),g=h(g,a,l,d,u[p+2],9,-51403784),d=h(d,g,a,l,u[p+7],14,1735328473),a=y(a,l=h(l,d,g,a,u[p+12],20,-1926607734),d,g,u[p+5],4,-378558),g=y(g,a,l,d,u[p+8],11,-2022574463),d=y(d,g,a,l,u[p+11],16,1839030562),l=y(l,d,g,a,u[p+14],23,-35309556),a=y(a,l,d,g,u[p+1],4,-1530992060),g=y(g,a,l,d,u[p+4],11,1272893353),d=y(d,g,a,l,u[p+7],16,-155497632),l=y(l,d,g,a,u[p+10],23,-1094730640),a=y(a,l,d,g,u[p+13],4,681279174),g=y(g,a,l,d,u[p+0],11,-358537222),d=y(d,g,a,l,u[p+3],16,-722521979),l=y(l,d,g,a,u[p+6],23,76029189),a=y(a,l,d,g,u[p+9],4,-640364487),g=y(g,a,l,d,u[p+12],11,-421815835),d=y(d,g,a,l,u[p+15],16,530742520),a=b(a,l=y(l,d,g,a,u[p+2],23,-995338651),d,g,u[p+0],6,-198630844),g=b(g,a,l,d,u[p+7],10,1126891415),d=b(d,g,a,l,u[p+14],15,-1416354905),l=b(l,d,g,a,u[p+5],21,-57434055),a=b(a,l,d,g,u[p+12],6,1700485571),g=b(g,a,l,d,u[p+3],10,-1894986606),d=b(d,g,a,l,u[p+10],15,-1051523),l=b(l,d,g,a,u[p+1],21,-2054922799),a=b(a,l,d,g,u[p+8],6,1873313359),g=b(g,a,l,d,u[p+15],10,-30611744),d=b(d,g,a,l,u[p+6],15,-1560198380),l=b(l,d,g,a,u[p+13],21,1309151649),a=b(a,l,d,g,u[p+4],6,-145523070),g=b(g,a,l,d,u[p+11],10,-1120210379),d=b(d,g,a,l,u[p+2],15,718787259),l=b(l,d,g,a,u[p+9],21,-343485551),a=a+S>>>0,l=l+m>>>0,d=d+v>>>0,g=g+w>>>0}return t.endian([a,l,d,g])};i._ff=function(e,t,r,n,o,s,i){var u=e+(t&r|~t&n)+(o>>>0)+i;return(u<<s|u>>>32-s)+t},i._gg=function(e,t,r,n,o,s,i){var u=e+(t&n|r&~n)+(o>>>0)+i;return(u<<s|u>>>32-s)+t},i._hh=function(e,t,r,n,o,s,i){var u=e+(t^r^n)+(o>>>0)+i;return(u<<s|u>>>32-s)+t},i._ii=function(e,t,r,n,o,s,i){var u=e+(r^(t|~n))+(o>>>0)+i;return(u<<s|u>>>32-s)+t},i._blocksize=16,i._digestsize=16,e.exports=function(e,r){if(null==e)throw new Error("Illegal argument "+e);var n=t.wordsToBytes(i(e,r));return r&&r.asBytes?n:r&&r.asString?s.bytesToString(n):t.bytesToHex(n)}}()},242:e=>{var t,r;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var o=e[n]<<16|e[n+1]<<8|e[n+2],s=0;s<4;s++)8*n+6*s<=8*e.length?r.push(t.charAt(o>>>6*(3-s)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,o=0;n<e.length;o=++n%4)0!=o&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(n))>>>6-2*o);return r}},e.exports=r},438:e=>{e.exports=import("@wordpress/interactivity-router")},703:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},934:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=t}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const o=(s={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withScope:()=>e.withScope,withSyncEvent:()=>e.withSyncEvent},i={},n.d(i,s),i);var s,i,u=n(150),c=n.n(u);function a(e){return Object.values(e).filter((e=>e.correct))}function l(e){return Object.values(e).filter((e=>!e.correct))}const{wp:d,location:g,localStorage:p}=window,{url:f,apiFetch:h}=d,{addQueryArgs:y,getQueryArg:b,getPathAndQueryString:S}=f,{state:m,actions:v}=(0,o.store)("prc-quiz/controller",{state:{currentSessionArchetypes:[],get quizId(){const{quizId:e}=(0,o.getContext)();return e},get nonce(){const{nonce:e}=(0,o.getContext)();return e},get quizData(){const{quizId:e}=(0,o.getContext)();return m[`quiz_${e}`]},get questions(){const{quizId:e}=(0,o.getContext)();return m[`quiz_${e}`].questions},get answers(){const{quizId:e}=(0,o.getContext)(),t=m[`quiz_${e}`];return Object.values(t.questions).reduce(((e,t)=>({...e,...t.answers})),{})},get isConditionalAnswerSelected(){const e=(0,o.getContext)(),{conditionalDisplay:t,conditionalAnswerUuid:r,selectedAnswers:n,uuid:s,quizId:i}=e;if(!t||!r)return!1;if(m[`quiz_${i}`].questions[r])return Object.keys(m[`quiz_${i}`].questions).includes(r)&&n[r].length>0;const u=Object.values(n).flat();return u.includes(r)||u.includes(s)},get displayResults(){const{displayResults:e}=(0,o.getContext)();return e},get displayPages(){const{displayType:e}=(0,o.getContext)();return"scrollable"===e||!m.displayResults&&!m.displayGroupResults},get displayGroupResults(){const{displayGroupResults:e}=(0,o.getContext)();return e},get hasConsentForCookies(){return"function"!=typeof window.wp_has_consent||window.wp_has_consent("functional")},get quizProgress(){const e=m.cookie;return e&&"object"==typeof e&&e.quiz_id?e:null},get hasQuizProgress(){const{quizId:e}=(0,o.getContext)(),t=m.quizProgress;return t&&t.quiz_id===e},get cookie(){if(!m.hasConsentForCookies)return null;const e=document.cookie.split(";");for(let t=0;t<e.length;t++){let r=e[t];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf("prc-quiz-builder=")){const e=r.substring(17,r.length),t=decodeURIComponent(e);try{return JSON.parse(t)}catch(e){return t}}}return null}},actions:{scoreQuiz:()=>{const{userSubmission:e}=(0,o.getContext)(),{answers:t,questions:r}=m;return function(e,t,r){if(!t||!r)return null;const n=c()(e.join(",")),o=function(e,t){return e.reduce(((e,r)=>e+t[r].points),0)}(e,t),s=function(e,t){const r={};return Object.values(e).forEach((e=>{const n=e.uuid,o=e.internalId||n,s=Object.values(e.answers).find((e=>t.includes(e.uuid))),i=s?.points||0;r[o]=i})),r}(r,e),i=function(e,t){const r={};return t.forEach((t=>{const n=e[t];n&&(r[t]=n.points)})),r}(t,e);return{hash:n,score:o,userSubmission:e,resultsData:{correctAnswersGiven:e.filter((e=>t[e].correct)),incorrectAnswersGiven:e.filter((e=>!t[e].correct)),questionPointsMatrix:s,answerPointsMatrix:i},quizData:{correctAnswers:a(t),incorrectAnswers:l(t)}}}(e,t,r)},runAnimation:()=>{const{ref:e}=(0,o.getElement)(),t=(0,o.store)("prc-block/animation"),r=e.querySelectorAll(".wp-block-prc-block-animation");r.length&&r.forEach((e=>{const r=e.getAttribute("id"),{parentElement:n}=e,o=null!==n?.getAttribute("hidden");r&&!o&&(t.state[r].enabled=!0)}))},onStartQuizClick:(0,o.withSyncEvent)((e=>{const t=(0,o.getContext)(),{uuid:r,currentPageUuid:n,pages:s}=t;t.currentPageUuid=s[1],v.saveQuizProgress()})),onNextPageClick:(0,o.withSyncEvent)((e=>{const t=(0,o.getContext)(),{uuid:r,currentPageUuid:n,pages:s}=t,i=s.indexOf(n);t.currentPageUuid=s[i+1],v.saveQuizProgress()})),onPreviousPageClick:(0,o.withSyncEvent)((e=>{const t=(0,o.getContext)(),{uuid:r,currentPageUuid:n,pages:s}=t,i=s.indexOf(n);t.currentPageUuid=s[i-1],v.saveQuizProgress()})),onSubmitQuizClick:(0,o.withSyncEvent)((e=>{v.submitQuiz()})),onResetQuizClick:(0,o.withSyncEvent)((e=>{const t=(0,o.getContext)(),{quizUrl:r,displayResults:n}=t;n?window.location.href=r:v.resetQuiz(),v.saveQuizProgress()})),goBackToFirstPage:()=>{const e=(0,o.getContext)();e.processing=!1,e.submitted=!1,e.currentPageUuid=e.firstPageUuid},resetQuiz:()=>{const e=(0,o.getContext)();e.submitted=!1,e.processing=!1,e.displayResults=!1,e.selectedAnswers={},e.userSubmission={},e.userScore={},e.currentPageUuid=e.firstPageUuid},clearCookie:()=>{document.cookie="prc-quiz-builder=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},setCookie:e=>{const{quizId:t}=(0,o.getContext)();if(!m.hasConsentForCookies)return!1;let r;r="object"==typeof e&&null!==e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e));const n=new Date;n.setTime(n.getTime()+2592e6);const s="expires="+n.toUTCString();return document.cookie="prc-quiz-builder="+r+";"+s+";path=/",!0},saveQuizProgress:(e=null)=>{const{selectedAnswers:t,currentPageUuid:r,quizId:n}=(0,o.getContext)(),s={quiz_id:n,selectedAnswers:t,currentPageUuid:r,timestamp:Date.now()};return e&&(s.score=e),v.setCookie(s)},*submitQuiz(){const e=(0,o.getContext)(),{answerThreshold:t,displayType:r,userScore:s,quizId:i,nonce:u,groupsEnabled:c,groupId:a,quizUrl:l,readyForSubmission:d,allowSubmissions:g,isPreview:p}=e,{hash:f,userSubmission:b,score:S}=s;let w=null,z={hash:f,userSubmission:b,score:S};if(e.processing=!0,!d)return void(confirm(`You must answer ${t} questions to submit the quiz.\n\nWould you like to reset the quiz and start over?`)?v.resetQuiz():"scrollable"!==r&&confirm("Would you like to go back to the first page to answer more questions?")&&v.goBackToFirstPage());const C={quizId:i,nonce:u};c&&a&&(C.groupId=a),v.parseSubmissionRequest&&(z=yield v.parseSubmissionRequest(z),S!==z.score&&(w=z.score)),setTimeout((0,o.withScope)((function*(){const t=yield Promise.resolve().then(n.bind(n,438));return e.displayResults=!0,p?(e.readyForSubmission=!1,e.processing=!1,void(w&&(e.userScore={...e.userScore,score:w}))):(v.clearCookie(),t.actions.navigate(`${l}results/${f}`),m.currentSessionArchetypes.includes(f)||!g?(e.readyForSubmission=!1,e.processing=!1,void(w&&(e.userScore={...e.userScore,score:w}))):(m.currentSessionArchetypes.push(f),void h({path:y("/prc-api/v3/quiz/submit",C),method:"POST",data:z}).then((e=>{console.log("submitQuiz response ->",e)})).catch((e=>{console.error("submitQuiz error ->",e)})).finally((()=>{w&&(e.userScore={...e.userScore,score:w}),e.processing=!1,e.readyForSubmission=!1}))))})),1e3)}},callbacks:{onInit:()=>{const e=(0,o.getContext)();e.processing=!0,setTimeout((0,o.withScope)((()=>{e.processing=!1,e.loaded=!0})),1500)},onScrollableSubmit:(0,o.withSyncEvent)((()=>{const e=(0,o.getContext)(),{submitted:t,readyForSubmission:r,displayType:n,processing:s}=e;"scrollable"===n&&r&&!s&&setTimeout((0,o.withScope)((()=>{v.submitQuiz()})),1200)})),updateUserSubmission:()=>{const e=(0,o.getContext)(),{selectedAnswers:t,answerThreshold:r}=e,n=Object.values(t||{}).flat();e.userSubmission=n,n.length>=r&&(e.readyForSubmission=!0)},updateUserScore:()=>{const e=(0,o.getContext)(),{userSubmission:t,quizId:r,displayResults:n}=e;if(n)return;if(!t)return;if(!r)return;if(0===t.length)return;e.userScore;const s=v.scoreQuiz();e.userScore=s}}});
//# sourceMappingURL=view.js.map